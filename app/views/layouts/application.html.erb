<!DOCTYPE html>
<html>
<head>
  <title>Ipoh Airport - Cleartrip</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>
  <style>
    html {
      font-size: 10px;
      font-family: sans-serif;
      box-sizing: border-box;
    }
    *, *:before, *:after { box-sizing: inherit; }
    body {
      font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,Liberation Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;
      font-size: 14px;
      line-height: 1.42857143;
      color: #333;
      margin: 0 auto;
      min-width: 320px;
      max-width: 1160px;
      background: #fcfcfc;
    }
    h1, h2, h3, h4 {
      font-weight: 600;
      color: #30343b;
      letter-spacing: 0;
      margin-block-end: 0.5em;
      margin-block-start: 0.5em;
    }
    h1 { font-size: 2.14rem; margin: 22px 0 9px 8px; padding-left: 2px; }
    h2 { font-size: 2.14rem; margin: 22px 0 9px 0; }
    h3 { font-size: 15px; margin: 17px 0 8px 0; color: #000; letter-spacing: .02em; font-weight: 700;}

    /* TOPBAR */
    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #e6e6e6;
      padding: 13px 0 13px 0;
      background: #fff;
      position: relative;
    }
    .top-left img { height: 24px; margin-right: 10px;cursor: pointer;}
    .top-left { display: flex; align-items: center; margin-left: 8px; }
    .top-right { margin-right: 40px; position: relative; }
    .flag-circle { width: 32px; height: 32px; border-radius: 50%; overflow: hidden; border: 1px solid #ccc; display: inline-block; cursor: pointer;}
    /* Country flag custom dropdown */
    .country-dropdown {
      padding: 8px 0;
      box-shadow: 0 6px 18px #0001;
      background: #fff;
      border: 1px solid #eee;
      border-radius: 10px;
      position: absolute;
      right: 0px;
      top: 36px;
      z-index: 1000;
      min-width: 140px;
      display: none;
    }
    .country-option {
      display: flex;
      align-items: center;
      padding: 8px 14px;
      cursor: pointer;
      font-size: 15px;
      transition: background .18s;
    }
    .country-option:hover { background: #c2dafaff; }

    /* SEARCH BAR */
    .bento-search-widget {
      padding: 0 0 15px 0;
      border-bottom: 1px solid #e6e6e6;
      background: #fff;
      position: relative;
      max-width: 100%;
      margin: 0 auto 0 0; 
    }
    .search-box {
      display: flex;
      align-items: center;
      gap: 25px;
      width: 100%;
      max-width: 98vw;
      margin: 8px auto 0 0;
      background: none;
      padding: 0; 
    }
    .search-box select,
    .search-box input[type="text"], .search-box input[type="date"] {
      border: 1px solid #e5e6eb;
      background: #fff;
      border-radius: 4px;
      padding: 0 13px;
      height: 42px;
      min-width: 134px;
      max-width: 186px;
      font-size: 12px;
      color: #222;
      font-family: inherit;
      outline: none;
      font-weight: 500;
    }
    .search-box select { min-width: 116px; max-width: 140px; }
    .search-box input[type="text"] { min-width: 140px; max-width: 182px; }
    .search-box input[type="text"]:not(:last-of-type) { margin-right: 0; }
    .search-box input[type="text"]::placeholder {
      color: #bababa;
      font-weight: 500;
      font-size: 12px;
    }
    .swap-btn {
      height: 38px;
      width: 44px;
      border: none;
      background: #fffdfde5;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      padding: 0;
      margin: 0 -7px 0 -7px;
      cursor: pointer;
      border: 0 solid #e5e6eb;
    }
    .swap-btn svg { display: block; }
    .search-btn {
      background: #ff6601;
      color: white;
      border: none;
      border-radius: 4px;
      font-weight: 600;
      font-size: 1.63rem;
      height: 42px;
      min-width: 108px;
      margin-left: 3px;
      padding: 0 25px;
      letter-spacing: 0.01em;
      transition: background 0.17s;
      cursor: pointer;
    }
    .search-btn:hover { background: #0057faff; }
    .breadcrumb {
      font-size: 13.3px;
      color: #1c8ef8ff;
      margin: 21px 0 6px 8px;
      max-width: 910px;
      padding-left: 0;
      font-weight: 400;
      letter-spacing: 0.03em;
    }
    .breadcrumb a, .breadcrumb {
      color: #a3a6a8ff;
      text-decoration: none;
      cursor: default;
      pointer-events: none;
      margin-top: 1px;
    }
    .breadcrumb a:visited { color: #888; }
    .breadcrumb a:hover { text-decoration: underline; color: #f85a1cff;cursor:pointer;}
    .line-separator {
      border: none; 
      background-color: #e2e2e2;
      margin: 0 0 -20px 8px;
      width: 910px;
      max-width: 98vw;
      display: block;
    }
    .main-area {
      display: flex;
      gap: 60px;
      margin: 0 auto;
      width: 97%;
      max-width: 1150px;
    }
    .content-main  { width: 80%; max-width: 900px;}
    .sidebar   { width: 28%; min-width: 250px; }
    .highlight {
      background: #fffbe6;
      color: #535353;
      border-left: 4px solid #ffe58f;
      border-radius: 6px;
      margin: 0 0 25px 8px;
      padding: 17px 18px 13px 15px;
      font-size: 15.3px;
      max-width: 100%;
      font-family:arial, sans-serif;
    }
    .section { margin-bottom: 29px; margin-left: -5px;}
    ol, ul { color: #454545; font-size: 15.2px; margin: 0.7em 0 0.4em 0; }
    .section ul, .section ol { margin-left: 1.25em; }
    .info-table {
      border-collapse: collapse;
      border-spacing: 0;
      width: 100%;
      height:100%;
      font-size: 15.4px;
      border: 1.7px solid #b5b5b5;
      background: #fff;
      border-radius: 5px;
      overflow: hidden;
      box-shadow: 0 2px 6px #edece5;
    }
    .info-table th, .info-table td {
      border: 1px dotted #131111ff;
      padding: 9px 12px 9px 13px;
      color: #393939;
      font-weight: 400;
      background: #fff;
      font-size: 15.2px;
    }
    .info-table td:first-child {
      background: #fafafc;
      color: #686868;
      font-weight: 1000;
      width: 130px;
    }
    .sidebar img {
      width: 100%;
      max-width: 310px;
      height: 410px;
      object-fit: cover;
      border-radius: 0;
      border: 1px solid #eaeaea;
      box-shadow: 0 3px 10px #0002;
      margin-bottom: 20px;
      margin-top: -50px;
      display: block;
    }
    .sidebar ul {
      list-style: none;
      padding-left: 0;
      margin: 0 0 18px 0;
      color: #26315a;
      font-size: 12px;
    }
    .sidebar ul li { margin-bottom: 6px; }
    .sidebar-airlines-list {
      list-style: none;
      padding: 0;
      margin: 0 0 8px 0;
    }
    .sidebar-airlines-list li {
      display: flex;
      align-items: center;
      gap: 20px;
      padding: 2px 0;
      font-size: 14.2px;
      color: #26315a;
      font-weight: 500;
    }
    .sidebar-airline-logo img {
      width: 35px;
      height: 35px;
      object-fit: contain;
      border-radius: 6px;
      background: #fff;
      border: 1px solid #ddebf4;
      padding: 2px;
      box-sizing: border-box;
      margin-top: 5px;
    }
    .sidebar-airline-name {
      margin-left: 0;
      font-size: 12px;
      font-weight: 500;
      color: #333cb0;
      text-decoration: none;
    }
    .sidebar-airline-name:hover { text-decoration: underline; }
    .footer-zone {
      background: #f7f7f7;
      margin-top: 1px;
      padding: 10px 0 0 20px;
      margin-left: -40px;
      margin-right: -40px;
      border-top: 1px solid #ececec;
      width: auto;
      min-width: 740px;
    }
    .footer-links {
      width: 96%;
      margin: auto;
      max-width: 1200px;
      font-size: 12px;
      color: #8a8a8a;
      line-height: 1.8;
      padding: 0 15px 0 8px;
    }
    .foot{ margin-left:15px }
    .footer-section-title {
      color: #0e0202ff;
      font-weight: 700;
      font-size: 13px;  display: inline; margin-left: 1px;
      font-family: sans-serif;
    }
    .bottom-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 8px auto 0 auto;
      border-top: 0;
      font-size: 12px;
      color: #888;
      padding: 8px 28px 23px 14px;
      letter-spacing: .01em;
    }
    .bottom-footer a { color: #213; margin-left: 1px; font-size: 12px;}
    /* [Responsive & mobile-specific CSS here - unchanged] */
    /* ... */

    /* FOR MOBILE VIEW WE CAN USE BELOW LOGIC */


    @media (max-width: 1150px) {
  .search-box, .breadcrumb, .line-separator, h1, h2, h3, .content-main,.section,.sidebar,.sidebar ul{
    flex-wrap: wrap !important;
    width: 100% !important;
    max-width: 100% !important;
    gap: 10px !important;
    box-sizing: border-box !important;
    margin: 0 !important;
    padding: 0 2vw !important;
    
  }
 
  .sidebar-airline-logo img {
    width: 22px !important;
    height: 22px !important;
    object-fit: cover !important;
    border-radius: 6px !important;
    margin-top: 2px !important;
    padding: 1px !important;
  
}
  .main-area {
    flex-direction: column !important;
    width: 99vw !important;
    max-width: 100vw !important;
    gap: 0 !important;
  }
  .sidebar img {
    min-width: 140px !important;
    max-width: 100% !important;
    margin-top: 5px !important;
  }
  .sidebar, .content-main {
    width: 100% !important;
  }
 
 /* Restrict airline logo size and prevent stretching */
.sidebar-airline-logo img {
  width: 32px !important;
  height: 32px !important;
  max-width: 32px !important;
  max-height: 32px !important; 
  min-width: 32px !important;
  min-height: 32px !important;  
  
  border-radius: 6px !important; 
  object-fit: contain !important; /* Keeps aspect ratio, adds whitespace if needed */
}

 

  .footer-zone {
    width: 100vw !important;
    min-width: 0 !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
    box-sizing: border-box !important;
    padding-left: 2vw !important;
    padding-right: 0 !important;
    }
}

    @media (max-width: 700px) {
  .search-box {
    flex-direction: column !important;
    align-items: stretch !important;
    gap: 10px !important;
    width: 98vw !important;
    margin: 0 auto !important;
    padding: 0 2vw !important;
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 1px 6px #e4e2ed55;
    box-sizing: border-box;
    

  }
  .search-box select,
  .search-box input[type="text"],
  .search-box input[type="date"] {
    width: 100% !important;
    min-width: 0 !important;
    max-width: 100% !important;
    margin-right: 0 !important;
    font-size: 12px !important;
    margin-bottom: 0 !important;
    box-sizing: border-box !important;
  }
  .swap-btn {
    
    align-self: center !important; /* centers the swap button vertically */
    width: 40px !important;
    margin: 0 0 0 0 !important;
    border: 2px solid #e5e6eb !important;
    border-radius: 50% !important;
  }
  .search-btn {
    width: 100%;
    min-width: 0;
    font-size: 1.2rem !important;
    padding: 0.7em 0 !important;
    margin-left: 0 !important;
    margin-top: 8px !important;
  }
  .bento-search-widget {
    padding: 6px 0 18px 0 !important;
    margin: 3px 0 !important;
    border-radius: 10px !important;
    border-bottom: 0.5px solid #eee !important;
  }
}

.dropdown-list {
  position: absolute;
  left: 0;
  top: 44px; /* below input */
  background: #fff;
  border: 1px solid #ddd;
  max-height: 260px;
  overflow-y: auto;
  width: 100%;
  min-width: 240px;
  box-shadow: 0 2px 12px #0002;
  z-index: 1200;
  display: none; /* Hide by default */
}

.dropdown-list .dropdown-item {
  padding: 8px 14px;
  cursor: pointer;
  font-size: 14px;
  border-bottom: 1px solid #f5f5f5;
}

.dropdown-list .dropdown-item:last-child {
  border-bottom: none;
}

.dropdown-list .dropdown-item:hover,
.dropdown-list .dropdown-item.active {
  background: #3577ec;
  color: #fff;
}

  </style>
</head>



<body>
<div class="topbar">
  <div class="top-left">
    <%= image_tag 'logo.png', alt: 'Cleartrip Logo' %>
    <%= image_tag 'flight.png', alt: 'Flights' %>
    <%= image_tag 'hotel.png', alt: 'Hotels' %>
    <%= image_tag 'discount.png', alt: 'Discounts' %>
  </div>
  <div class="top-right">
    <div class="flag-circle" id="selected-flag" tabindex="0">
    <%= image_tag 'uae-flag.png', id: 'country-flag', alt: 'Country Flag', style: 'width:100%;height:100%;object-fit:cover;' %>
      <%# <img src="<%= asset_path 'uae-flag.png'" id="country-flag" alt="Country Flag" style="width:100%;height:100%;object-fit:cover;"> %> %>
    </div>
    <div class="country-dropdown" id="country-dropdown">
      <div class="country-option" data-flag="<%= asset_path 'uae-flag.png' %>">
          <img src="<%= asset_path 'uae-flag.png' %>" style="width:26px;height:26px;border-radius:50%;margin-right:20px;">UAE
      </div>
      <div class="country-option" data-flag="<%= asset_path 'india-flag.png' %>">
         <img src="<%= asset_path 'india-flag.png' %>" style="width:26px;height:26px;border-radius:50%;margin-right:20px;">India
      </div>
      <div class="country-option" data-flag="<%= asset_path 'saudi-flag.png' %>">
          <img src="<%= asset_path 'saudi-flag.png' %>" style="width:26px;height:26px;border-radius:50%;margin-right:20px;">Saudi Arabia
      </div>
      <div class="country-option" data-flag="<%= asset_path 'oman-flag.png' %>">
        <img src="<%= asset_path 'oman-flag.png' %>" style="width:26px;height:26px;border-radius:50%;margin-right:20px;">Oman
      </div>
    </div>
  </div>
</div>

<div class="bento-search-widget">
  <div class="search-box">
    <select id="flight-type">
      <option selected>One way</option>
      <option>Round trip</option>
    </select>

    <%# <input list="airports" id="input-from" placeholder="Any Airport or City">

        <datalist id="airports" >
          <%# Dynamically populated %>

        </datalist>
    

    <div style="position:relative; max-width:340px;">
      <input type="text" id="input-from" autocomplete="off" placeholder="Any Airport or City">
      <div id="dropdown-from" class="dropdown-list"></div>
    </div>

    <button class="swap-btn" type="button" aria-label="Swap" onclick="swapInputs()">
      <svg width="35" height="20" viewBox="0 0 30 21" xmlns="http://www.w3.org/2000/svg">
        <line x1="4" y1="7" x2="24" y2="7" stroke="#3577ec" stroke-width="2" stroke-linecap="round"/>
        <polyline points="20,4 24,7 20,10" fill="none" stroke="#3577ec" stroke-width="2" stroke-linecap="round"/>
        <line x1="24" y1="13" x2="4" y2="13" stroke="#3577ec" stroke-width="2" stroke-linecap="round"/>
        <polyline points="8,10 4,13 8,16" fill="none" stroke="#3577ec" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>

    <div style="position:relative; max-width:340px;">
      <input type="text" id="input-to" autocomplete="off" placeholder="Any Airport or City">
      <div id="dropdown-to" class="dropdown-list"></div>
    </div>    

    <input type="date" style="font-weight:100;">
    <input type="text" id="return-date" placeholder="Return On">
    <script>
      function toggleReturnDate() {
        var flightType = document.getElementById("flight-type").value;
        var returnDate = document.getElementById("return-date");
        if (flightType === "One way") {
          returnDate.disabled = true;
          returnDate.value = "";
          returnDate.placeholder = "Return On";
          returnDate.type = "text";
        } else {
          returnDate.disabled = false;
          returnDate.type = "date";
          returnDate.placeholder = "";
        }
      }
      toggleReturnDate();
      document.getElementById("flight-type").addEventListener("change", toggleReturnDate);
    </script>
    <select>
      <option selected>01 Traveller</option>
      <%# <option>01 Traveller</option> %>
      <option>02 Travellers</option>
      <option>03 Travellers</option>
      <option>04 Travellers</option>
      <option>05 Travellers</option>
    </select>
    <button class="search-btn">Search</button>
  </div>
</div>


<div class="breadcrumb" >
  Home &raquo; Tourism &raquo; Ipoh Airports
</div>
<hr class="line-separator">



<%= yield %>


<script>
  // FLAG SELECTOR FUNCTIONALITY
  document.getElementById('selected-flag').addEventListener('click', function(e) {
    e.stopPropagation();
    var drop = document.getElementById('country-dropdown');
    drop.style.display = (drop.style.display === 'none' || drop.style.display === '') ? 'block' : 'none';
  });
  document.querySelectorAll('.country-option').forEach(function(opt) {
    opt.addEventListener('click', function() {
      var flag = this.getAttribute('data-flag');
      document.getElementById('country-flag').src = flag;
      document.getElementById('country-dropdown').style.display = 'none';
    });
  });
  document.addEventListener('click', function(e) {
    document.getElementById('country-dropdown').style.display = 'none';
  });

  function swapInputs() {
    var inputFrom = document.getElementById('input-from');
    var inputTo = document.getElementById('input-to');
    var temp = inputFrom.value;
    inputFrom.value = inputTo.value;
    inputTo.value = temp;
  }

  //without datalist using didv we did the dropdown here

  document.addEventListener('DOMContentLoaded', function() {
  fetch('/data.json')
    .then(res => res.json())
    .then(data => {
      let routes = data.routes_data ? data.routes_data.routes : data.routes;

      // Build array with all available city and airport labels
      const airportSet = new Set();
      routes.forEach(route => {
        if (route.dep_city_name && route.dep_airport_name && route.dep_city_code) {
          airportSet.add(`${route.dep_city_name}, IN - ${route.dep_airport_name} (${route.dep_city_code})`);
        }
        if (route.arr_city_name && route.arr_airport_name && route.arr_city_code) {
          airportSet.add(`${route.arr_city_name}, IN - ${route.arr_airport_name} (${route.arr_city_code})`);
        }
      });
      const cityAirportLabels = Array.from(airportSet);

      // autocomplete for both inputs
      function setupAutocomplete(inputId, dropdownId) {
        const input = document.getElementById(inputId);
        const dropdown = document.getElementById(dropdownId);

        input.addEventListener('input', function(e) {
          const val = e.target.value.trim().toLowerCase();
          dropdown.innerHTML = '';
          if (!val) {
            dropdown.style.display = 'none';
            return;
          }
          const matches = cityAirportLabels.filter(label =>
            label.toLowerCase().includes(val)
          ).slice(0, 10);

          if (matches.length === 0) {
            dropdown.style.display = 'none';
            return;
          }

          matches.forEach(label => {
            const item = document.createElement('div');
            item.className = 'dropdown-item';
            item.textContent = label;
            item.addEventListener('mousedown', function() {
              input.value = label;
              dropdown.style.display = 'none';
            });
            dropdown.appendChild(item);
          });
          dropdown.style.display = 'block';
        });

        input.addEventListener('blur', function() {
          setTimeout(() => { dropdown.style.display = 'none'; }, 150);
        });

        input.addEventListener('keydown', function(e) {
          if (e.key === 'Escape') dropdown.style.display = 'none';
        });
            }

            // Call setupAutocomplete for both inputs
            setupAutocomplete('input-from', 'dropdown-from');
            setupAutocomplete('input-to',   'dropdown-to');
          })
          .catch(err => {
            console.error("Error loading flight data:", err);
          });
      });


//     

//   // 1. Load json

//  document.addEventListener('DOMContentLoaded', function() {
//   fetch('/data.json')
//     .then(res => res.json())
//     .then(data => {
//       let routes = data.routes_data.routes; // getting the routed from data.json

//       // get rotes from json

//       function populateAirportsDropdown(routesArr) {
//         const datalist = document.getElementById('airports');
//         if (!datalist) return;
//         const airportSet = new Set();
//         routesArr.forEach(route => {
         
//           // Dep airport
//           if (
//             route.dep_city_name && route.dep_airport_name && route.dep_city_code
//           ) {
//             // Example: Chennai, IN - Chennai Airport (MAA)
//             airportSet.add(`${route.dep_city_name}, IN - ${route.dep_airport_name} (${route.dep_city_code})`);
//           }
//           // Arr airport 
//           if (
//             route.arr_city_name && route.arr_airport_name && route.arr_city_code
//           ) {
//             airportSet.add(`${route.arr_city_name}, IN - ${route.arr_airport_name} (${route.arr_city_code})`);
//           }
//         });
//         datalist.innerHTML = '';
//         airportSet.forEach(label => {
//           const option = document.createElement('option'); 
//           option.value = label;
//           datalist.appendChild(option);
//         });
//       }

//       populateAirportsDropdown(routes);
      
//     })
//     .catch(err => {
//       console.error("Error loading flight data:", err);
//     });
// });

</script>
</body>
</html>
